{{ $author_pages := . }}
{{ $university_current_year :=  partial "functions/university_current_year" . }}
{{ $avatar_shape := site.Params.avatar.shape | default "circle" }}
{{ $no_author_image := (site.GetPage "/authors").Resources.GetMatch "no_author_image.png" }}

{{ $year := 0 }}
{{ $has_no_authors := false}}
{{ $is_first_author_of_the_year := true}}
<div class="author-card-list">
  {{ range sort (apply $author_pages "partial" "functions/get_author_dict.html" ".") "year" "desc" }}
    {{ if ne $year .year }}
      {{if not $is_first_author_of_the_year}}
        </div>
      {{else}}
        {{$is_first_author_of_the_year = false}}
      {{end}}
      <h2 class="author-card-container-title">{{ partial "university_grade" .page.Params.university }}</h2>
      <div class="author-card-container">
    {{ end }}
    {{ $year = .year }}
    {{ $image_src := $no_author_image.RelPermalink }}
    {{ with (.page.Resources.ByType "image").GetMatch "avatar.*" }}
      {{ $image_src = .RelPermalink }}
    {{ end }}
    <div class="card author">
      <a href="{{ .page.RelPermalink }}" style="text-decoration: none;" >
        <img class="avatar {{if eq $avatar_shape "square"}}avatar-square{{else}}avatar-circle{{end}}" src="{{$image_src}}" alt="{{.page.Title}}" >
        <div style="width: 100%;">
          <h5 class="card-title">{{.page.Title}}</h5>
          {{ with .page.Params.role }}<h6 class="card-subtitle">{{. | markdownify | emojify}}</h6>{{end}}
        </div>
        {{ with .page.Params.bio }}<p class="card-text">{{. | markdownify | emojify}}</p>{{end}}
      </a>
    </div>
  {{else}}
    {{ $has_no_authors = true}}
  {{end}}
  {{if not $has_no_authors}}
    </div>
  {{end}}
</div>