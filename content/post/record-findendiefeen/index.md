---
# Documentation: https://sourcethemes.com/academic/docs/managing-content/

title: "Finden die Feen 開発記録"
subtitle: ""
summary: "Finden die Feen の企画から公開までの開発記録"
authors: ["yan"]
tags: ["Unity"]
categories: ["Works"]
date: 2020-06-22T18:54:11+09:00
featured: false
draft: false

# Featured image
# To use, add an image named `featured.jpg/png` to your page's folder.
# Focal points: Smart, Center, TopLeft, Top, TopRight, Left, Right, BottomLeft, Bottom, BottomRight.
image:
  caption: ""
  focal_point: ""
  preview_only: false

# Projects (optional).
#   Associate this post with one or more of your projects.
#   Simply enter your project's folder or file name without extension.
#   E.g. `projects = ["internal-project"]` references `content/project/deep-learning/index.md`.
#   Otherwise, set `projects = []`.
projects: []
---
# はじめに

この記事は，2020年5月30日から31日にかけて行われた [__府大バーチャル学祭__](https://ch-random.net/post/167/) で展示された __Finden die Feen__ というゲームの開発記事です。どういった経緯でこのゲームが開発されたかを，この記事に書いていこうと思います。

まずはじめに，__Finden die Feen__ とは以下のようなゲームです。
{{<tweet 1266598410095751169>}}

上記のように，迷路の中で音を頼りに妖精さんを探す __PC用ゲーム__ です。まだ遊んだことのない方は，以下から遊ぶことができます。ぜひ遊んでみてからこの記事を読んでみてください。(音量注意！！！)

{{<unity src="https://hiroyuki-nakaya.github.io/Finden-die-Feen/">}}

# 企画

ここでは，どのようにして __Finden die Feen__ を思いついたのか書いていきます。普段，私は毎年5月末に行われる大学の文化祭に向けてゲームを作っており，今年は「__探索__」というテーマでゲームを考えていました。このテーマは，「宝探しは楽しいよね！」と「あまりゲームが得意でない人でも遊べるゲーム」を両立させようという目論見がありました。そこで何かいい案はないかと[Unityゲーム プログラミング・バイブル](https://www.borndigital.co.jp/book/6633.html)という本をパラパラめくっていたところ，5章の「3D迷路」の部分を読み，「ここに書いてある迷路生成プログラムを用いれば __簡単に迷路が作れる__ のでは？」と思い，該当部分をステージ生成の基礎として，迷路の中でもの探しをするというゲームを思いつきました。

ただし，単に迷路を探索するだけでは既存の迷路ゲームと変わらず，[Unityゲーム プログラミング・バイブル](https://www.borndigital.co.jp/book/6633.html)の「3D迷路」の章のパクりとなり，なんら面白くありません。そこで，任天堂が2003年に発売した「__伝説のスタフィー2__」というゲームの道中にあった「__音で探す__」ゲームギミックを参考にしました。
{{<figure src="./blog_01.png" title="伝説のスタフィー2（出典：https://www.nintendo.co.jp/n08/avfj/gamen/index.html）">}}
参考にしたギミックは「見えない探し物が近くにあればあるほど，アラームを激しく鳴らす」というものです。「伝説のスタフィー2」では，草むらに隠れた見えないターゲットを音を頼りに見つけ出すというゲーム要素があり，私自身「伝説のスタフィー2」を遊んだ時にこのギミックがとても楽しかった記憶があって，「音で探す」システムを採用しました。

以上より「__音を頼りに迷路を探索し妖精さんを見つける__」ゲームが企画されました。以下の画像は[ゲーム作りのはじめかた Unityで覚える企画からレベルデザインまで](https://www.sbcr.jp/product/4797377361/)という本の「まずはゲームの企画をA4 1枚にペンで書け！」といった教えにのっとり書いた企画書です。
{{<figure src="./blog_02.jpg" title="Finden die Feen 企画書">}}
上の企画書を見てみると，何個か夢物語が書いてありますが，「Finden die Feen」の原型は保たれてますね。また，この時点でゲームのタイトルはまだ決めていませんね。

ちなみに，この企画書は5月のはじめに書いたものです。提出締め切りが5月30日だったので，必然的に1か月で完成させなくてはいけなく，締め切り1週間前は地獄を見ました...。~~大学の文化祭が新型コロナウイルス騒ぎで中止になったと聞いて，今年はゲーム作らなくていいかと思ってたところにオンライン文化祭の通知が来たもん仕方ないね。~~

# 実装

## 1. 自動迷路生成の実装

代表的な迷路自動生成アルゴリズムには，以下の3種類があります。

- 棒倒し法（比較的簡単な迷路生成）
- 壁伸ばし法（複雑な迷路生成）
- 穴掘り法（複雑な迷路生成）

この中で，「Finden die Feen」の迷路自動生成アルゴリズムには「__穴掘り法__」を用いました。コードはたった5,000円で買える素晴らしい本，[Unityゲーム プログラミング・バイブル](https://www.borndigital.co.jp/book/6633.html)の5章「3D迷路」に載っていたものを~~パクリ~~参考にしました。この穴掘り法を用いると，以下の画像のように任意の大きさの複雑な迷路を勝手に生成してくれます。とても楽ですし素晴らしいですね。
{{<figure src="./blog_03.png" title="穴掘り法による迷路生成">}}

## 2. サウンドの実装

「Finden die Feen」では，妖精の位置によって音の鳴り方が変わり，プレイヤーからどれだけ近くに妖精がいるかを教えてくれるのが特徴です。この特徴的なソナー音やBGMなど，プレイヤーの位置に依存しないサウンドは，単一のゲームオブジェクトによる一括管理を行うことを考えます。このようなサウンドシステムの実装は，__シングルトンパターン__ を用いて実装されています。つまり，ゲーム実行中は常に1つのインスタンスが存在し，サウンドに関する処理を一括して行っています。ちなみに私はこの処理を，たった4,000円で買える本，[Unity サウンド エキスパート養成講座](https://www.borndigital.co.jp/book/15163.html)の1章のコードを~~パクって~~参考にして実装しました。

このような実装を行うと，音源の再生を行いたい場合に

```c#:
using SoundSystem;
```

と宣言して

```c#:
SoundManager.Instance.Play("音源のタイトル");
```

と任意の場所に書くと，音が再生されます。AudioSourceをGameObjectにいちいちアタッチせずに，たった1行処理を書くだけで音が再生されるので非常に便利です。

## 3. ムービーの実装

「Finden die Feen」では，チュートリアルや妖精を発見したときなどにムービーが流れます。
{{<figure src="./blog_04.png" title="ムービーシーン">}}
このムービーは，Unityの __Timeline__ という機能を用いて実装しました。Timelineを用いると，簡単にムービーシーンを作ることができるため大変便利です。
{{<figure src="./blog_05.png" title="UnityのTimeline">}}
画像のように，動画編集みたいに時系列でプログラムを書かずにオブジェクトを操作できます。今回はTimelineを用いてテキスト表示を行うカスタムクリップを[Timelineの拡張 ― 実践ガイド](https://blogs.unity3d.com/jp/2018/09/05/extending-timeline-a-practical-guide/)というサイトを参考に実装しました。何回かTimelineのカスタムクリップを実装したことはありますが，まともに勉強したのは初めてな気がします。

このとき，PlayableAssetを継承したクラス，PlayableBehaviourを継承したクラス，TrackAssetを継承したクラスそれぞれファイル名とクラス名を同じにしないと，Timelineからカスタムクリップが抜け落ちるという仕様に1日悩んだのはいい思い出です。~~少し考えれば，あたりまえなんですけどね。~~

# テストプレイから公開まで

ここでは，ゲームバランス調整について書いていこうと思います。一般論として，開発者がプレイして開発者がちょうどいいと思う難易度にすると，たいてい __超高難易度__ になります。そのため，テストプレイはできる限り第3者に行ってもらうのがオススメです。私は締め切り1日前に妹にテストプレイをしてもらい，制限時間などのパラメータを調節しました。

ちなみにこのとき，妹から

- 妖精のいる方角を示すコンパスの色の点滅
- 制限時間を増やすアイテムの追加
- 制限時間がなくなってきたら，BGMのピッチを上げる
- 残りの妖精の数をUI表示

の機能を実装したほうがいいという~~地獄のような~~素晴らしいアドバイスを __締め切り直前__ にいただき，締め切り前日の夜10時から締め切り当日の朝5時にかけて上記の機能を全て実装しました。このアドバイスによってよりゲームのクオリティが上がったと思うので妹には感謝しています。~~アドバイスをもらったときは妹にうっすら殺意を覚えましたが。~~

そして最後にゲームの __タイトル__ を決めました。なんでもかんでも __ドイツ語__ にするとカッコいいよねという安直な考えで，「Finden die Feen」というタイトルになりました。ちなみに英語にすると「Find the Fairies」です。「妖精を発見する」的な意味です。そのままです。このタイトルをつけるためだけに，2年ぶりにドイツ語の文法書を引っ張り出しました。~~ドイツ語の文法がおかしい？うるせえ黙れ！~~
{{<figure src="./blog_06.png" title="ゲームのタイトル画面">}}

# 最後に

このような感じで「Finden die Feen」は約1ヶ月という期間で製作し，府大バーチャル学祭で公開されました。個人的には，完成度がそこそこ高く見えるため気に入っています。特に気に入っているのは，以下の画像のステージです。
{{<figure src="./blog_07.png" title="お気に入りのステージ">}}
このステージは，赤，青，緑のライトが混ざり合うステージでとても綺麗だと思ってるのですが，みなさんはどう思いましたか？私はデバッグ中，このステージに1人で感動していました。

最後になりますが，ここまで読んで下さりありがとうございました。そしてまた改めて「Finden die Feen」で遊んでみてはいかがでしょうか？
