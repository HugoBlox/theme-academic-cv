---
title: "Fast Food Nutrition Analysis"
author: ''
date: '2019-04-10'
slug: fast-food-nutrition-analysis
tags: []
categories: []
---



<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.1       ✔ purrr   0.3.2  
## ✔ tibble  2.1.1       ✔ dplyr   0.8.0.1
## ✔ tidyr   0.7.2       ✔ stringr 1.2.0  
## ✔ readr   1.1.1       ✔ forcats 0.2.0</code></pre>
<pre><code>## Warning: package &#39;tibble&#39; was built under R version 3.4.4</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 3.4.4</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 3.4.4</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(ggthemes)
library(tidytext)</code></pre>
<pre><code>## Warning: package &#39;tidytext&#39; was built under R version 3.4.4</code></pre>
<pre class="r"><code>library(purrr)
library(stats)
library(corrr)
library(RColorBrewer)</code></pre>
<div id="r-markdown" class="section level2">
<h2>R Markdown</h2>
<pre><code>## # A tibble: 6 x 18
##      X1 restaurant item  calories cal_fat total_fat sat_fat trans_fat
##   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;int&gt;   &lt;int&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1     1 Mcdonalds  Arti…      380      60         7       2       0  
## 2     2 Mcdonalds  Sing…      840     410        45      17       1.5
## 3     3 Mcdonalds  Doub…     1130     600        67      27       3  
## 4     4 Mcdonalds  Gril…      750     280        31      10       0.5
## 5     5 Mcdonalds  Cris…      920     410        45      12       0.5
## 6     6 Mcdonalds  Big …      540     250        28      10       1  
## # … with 10 more variables: cholesterol &lt;int&gt;, sodium &lt;int&gt;,
## #   total_carb &lt;int&gt;, fiber &lt;int&gt;, sugar &lt;int&gt;, protein &lt;int&gt;,
## #   vit_a &lt;int&gt;, vit_c &lt;int&gt;, calcium &lt;int&gt;, salad &lt;chr&gt;</code></pre>
<p>What is up with the “salad” column?</p>
<pre><code>## [1] &quot;Other&quot;</code></pre>
<pre><code>## [1] &quot;Arbys&quot;       &quot;Burger King&quot; &quot;Chick Fil-A&quot; &quot;Dairy Queen&quot; &quot;Mcdonalds&quot;  
## [6] &quot;Sonic&quot;       &quot;Subway&quot;      &quot;Taco Bell&quot;</code></pre>
<pre class="r"><code>#select only 
# library(microbenchmark)
# microbenchmark(
#     dplyr::select_if(food, is.numeric),
#     Filter(is.numeric, food),
#     purrr::keep(food,is.numeric)
# )</code></pre>
</div>
<div id="subsetting-practice" class="section level2">
<h2>Subsetting Practice</h2>
<pre class="r"><code>##replace NA content with 0
food&lt;-food %&gt;% mutate_if(is.numeric, ~replace(., is.na(.), 0))

#using unlist(lapply(...)) is the same as sapply(...)

ind &lt;- as.logical(unlist(lapply(food,is.numeric)))

ind2 &lt;- as.logical(sapply(food,is.numeric))

#subset only numeric cols with logical indices
food_num&lt;-food[which(ind2)]
food_num%&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 14
##   calories cal_fat total_fat sat_fat trans_fat cholesterol sodium
##      &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;
## 1      380      60         7       2       0            95   1110
## 2      840     410        45      17       1.5         130   1580
## 3     1130     600        67      27       3           220   1920
## 4      750     280        31      10       0.5         155   1940
## 5      920     410        45      12       0.5         120   1980
## 6      540     250        28      10       1            80    950
## # … with 7 more variables: total_carb &lt;dbl&gt;, fiber &lt;dbl&gt;, sugar &lt;dbl&gt;,
## #   protein &lt;dbl&gt;, vit_a &lt;dbl&gt;, vit_c &lt;dbl&gt;, calcium &lt;dbl&gt;</code></pre>
<p>How many entries for each restaraunt? Use fct_infreq to reorder by appearance</p>
<pre class="r"><code>food %&gt;% ggplot(aes(x=fct_infreq(restaurant),fill=restaurant)) + 
  geom_histogram(stat = &quot;count&quot;)+ 
  scale_fill_brewer(palette = &quot;Purples&quot;) + 
  theme_dark()+
  xlab( &quot;Restaurant&quot;)</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code># Order restaurants by median number of calories
# cals = aggregate(calories ~ restaurant, median, data=salad)
# cals = cals[order(cals$calories, decreasing = T),]
# salad$restaurant = factor(salad$restaurant, levels=as.character(cals$restaurant))</code></pre>
<pre class="r"><code>#items containing bacon
food[str_detect(food$item, &quot;[Bb]acon|BLT|B.L.T&quot;),] </code></pre>
<pre><code>## # A tibble: 54 x 16
##    restaurant item  calories cal_fat total_fat sat_fat trans_fat
##    &lt;fct&gt;      &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 Mcdonalds  Sing…      840     410        45      17       1.5
##  2 Mcdonalds  Doub…     1130     600        67      27       3  
##  3 Mcdonalds  Gril…      750     280        31      10       0.5
##  4 Mcdonalds  Cris…      920     410        45      12       0.5
##  5 Mcdonalds  Mapl…      640     330        36      14       1.5
##  6 Mcdonalds  Gril…      580     190        21       8       0  
##  7 Mcdonalds  Cris…      740     310        35       9       0.5
##  8 Mcdonalds  Swee…      690     340        37      14       1.5
##  9 Mcdonalds  Gril…      630     200        22       7       0  
## 10 Mcdonalds  Cris…      800     320        36       9       0.5
## # … with 44 more rows, and 9 more variables: cholesterol &lt;dbl&gt;,
## #   sodium &lt;dbl&gt;, total_carb &lt;dbl&gt;, fiber &lt;dbl&gt;, sugar &lt;dbl&gt;,
## #   protein &lt;dbl&gt;, vit_a &lt;dbl&gt;, vit_c &lt;dbl&gt;, calcium &lt;dbl&gt;</code></pre>
<pre class="r"><code>bacon&lt;-food %&gt;% mutate(contains_bacon = str_detect(food$item, &quot;[Bb]acon|BLT|B.L.T&quot;)) %&gt;%
  group_by(contains_bacon) %&gt;% select_if(is.numeric) %&gt;% summarise_at(
    c(&quot;calories&quot;,&quot;sat_fat&quot;,&quot;trans_fat&quot;,&quot;total_fat&quot;,&quot;sodium&quot;,&quot;cholesterol&quot;), list(~mean(.)),na.rm=TRUE)</code></pre>
<pre class="r"><code>bacon %&gt;% gather(stat,content,-contains_bacon) %&gt;% ggplot(aes(x=stat,y=content,fill=contains_bacon))+ geom_col(position = &quot;dodge&quot;, stat = &quot;identity&quot;)+ facet_wrap(~stat,scales=&quot;free&quot;)+xlab(&quot;&quot;)</code></pre>
<pre><code>## Warning: Ignoring unknown parameters: stat</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>#show items that appear more than once
dup&lt;-food %&gt;% select(restaurant,item) %&gt;% duplicated()
food[which(dup),]</code></pre>
<pre><code>## # A tibble: 2 x 16
##   restaurant item  calories cal_fat total_fat sat_fat trans_fat cholesterol
##   &lt;fct&gt;      &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 Taco Bell  Chil…      380     150        17       8         1          35
## 2 Taco Bell  Expr…      580     260        29       9         1          60
## # … with 8 more variables: sodium &lt;dbl&gt;, total_carb &lt;dbl&gt;, fiber &lt;dbl&gt;,
## #   sugar &lt;dbl&gt;, protein &lt;dbl&gt;, vit_a &lt;dbl&gt;, vit_c &lt;dbl&gt;, calcium &lt;dbl&gt;</code></pre>
<pre class="r"><code>##remove duplicate items
food&lt;-food %&gt;% distinct(restaurant,item,.keep_all = T)

food&lt;-food %&gt;% mutate(item_num = row_number())
food</code></pre>
<pre><code>## # A tibble: 513 x 17
##    restaurant item  calories cal_fat total_fat sat_fat trans_fat
##    &lt;fct&gt;      &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 Mcdonalds  Arti…      380      60         7       2       0  
##  2 Mcdonalds  Sing…      840     410        45      17       1.5
##  3 Mcdonalds  Doub…     1130     600        67      27       3  
##  4 Mcdonalds  Gril…      750     280        31      10       0.5
##  5 Mcdonalds  Cris…      920     410        45      12       0.5
##  6 Mcdonalds  Big …      540     250        28      10       1  
##  7 Mcdonalds  Chee…      300     100        12       5       0.5
##  8 Mcdonalds  Clas…      510     210        24       4       0  
##  9 Mcdonalds  Doub…      430     190        21      11       1  
## 10 Mcdonalds  Doub…      770     400        45      21       2.5
## # … with 503 more rows, and 10 more variables: cholesterol &lt;dbl&gt;,
## #   sodium &lt;dbl&gt;, total_carb &lt;dbl&gt;, fiber &lt;dbl&gt;, sugar &lt;dbl&gt;,
## #   protein &lt;dbl&gt;, vit_a &lt;dbl&gt;, vit_c &lt;dbl&gt;, calcium &lt;dbl&gt;, item_num &lt;int&gt;</code></pre>
<pre class="r"><code>food_words&lt;-food %&gt;%
  unnest_tokens(word, item) %&gt;%
  anti_join(stop_words) %&gt;% filter(str_detect(word, &quot;^[a-z&#39;]+$&quot;)) %&gt;%
  distinct()

word_freq&lt;-food_words %&gt;% group_by(word) %&gt;%
  summarize(freq = n()) %&gt;%
  arrange(desc(freq))

word_freq %&gt;% mutate(word = reorder(word, freq)) %&gt;%
  head(25) %&gt;%  ggplot(aes(x = word, y = freq)) + geom_segment(aes(
    x = word,
    xend = word,
    y = 0,
    yend = freq
  ), color = &quot;black&quot;) + geom_point(size = 3, color = &quot;purple&quot;)+coord_flip()</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>(word_cal&lt;-food_words %&gt;% group_by(word) %&gt;% filter(length(word)&gt;2) %&gt;% mutate(cal_fat_perc=cal_fat/calories) %&gt;% 
  summarize(freq = n(),avg_cal=mean(calories),avg_cal_fat=mean(cal_fat), avg_calfat_perc=mean(cal_fat_perc)) %&gt;% arrange(avg_cal))</code></pre>
<pre><code>## # A tibble: 163 x 5
##    word    freq avg_cal avg_cal_fat avg_calfat_perc
##    &lt;chr&gt;  &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;
##  1 kids       4    178.        20             0.112
##  2 locos      6    183.        95             0.519
##  3 mini       6    183.        43.3           0.227
##  4 soft       8    196.        76.2           0.369
##  5 delite     4    222.        21.2           0.118
##  6 fresco     7    234.        62.9           0.288
##  7 garden     5    286        134             0.450
##  8 chick      5    288        124.            0.433
##  9 forest     4    290         41.2           0.154
## 10 ham        9    291.        48.9           0.183
## # … with 153 more rows</code></pre>
<pre class="r"><code>word_cal %&gt;% head(15) %&gt;%  ggplot(aes(x=fct_reorder(word,avg_calfat_perc),y=avg_cal,fill=avg_calfat_perc))+ geom_bar(stat = &quot;identity&quot;,position=&quot;dodge&quot;) +scale_fill_gradient()+coord_flip()</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>word_cal %&gt;% tail(15) %&gt;%  ggplot(aes(x=fct_reorder(word,avg_calfat_perc),y=avg_cal,fill=avg_calfat_perc))+ geom_bar(stat = &quot;identity&quot;,position=&quot;dodge&quot;) +scale_fill_gradient()+coord_flip()</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-14-1.png" width="672" />
Meats: chicken,bacon,beef,turkey,steak</p>
<pre class="r"><code># get the numb 70/30 training test split
# numberOfTrainingSamples &lt;- round(nrow(food) * .7)
# 
# # training data
# train_data &lt;- food[1:numberOfTrainingSamples,]
# train_labels&lt;-food$calories[1:nrow(train_data)]
# 
# # testing data
# test_data &lt;-food[-(1:numberOfTrainingSamples),]
# test_labels &lt;- food$calories[-(1:numberOfTrainingSamples)]
# 
# #count num times each word used in item name (for each item num), inner join to get only training samples
# train_sparse&lt;-food_words %&gt;% inner_join(train_data) %&gt;% count(item_num,word) %&gt;% cast_dtm(item_num,word,n)
# test_sparse&lt;-food_words %&gt;% count(item_num,word) %&gt;% inner_join(test_data) %&gt;% cast_dtm(item_num,word,n)
# 
# #convert sparse matrix to non-sparse
# options(na.action=&#39;na.pass&#39;) 
# train_dtm&lt;-as.matrix(train_sparse,na.action=&#39;pass&#39;)
# test_dtm&lt;-as.matrix(test_sparse)
# 
# #combine with outcome variable
# train_df&lt;-data.frame(train_dtm,calories=train_data$calories)
# test_df&lt;-data.frame(test_dtm,calories=test_data$calories)


food_sparse&lt;-food_words %&gt;% count(item_num,word,calories) %&gt;% cast_dtm(item_num,word,n)
train&lt;-as.matrix(food_sparse,na.action=&#39;pass&#39;)
train &lt;- cbind(train, c(0, 1))
colnames(train)[ncol(train)] &lt;- &#39;calories&#39;
train &lt;- as.data.frame(train)
train$calories &lt;- food$calories[1:512]
train$calories</code></pre>
<pre><code>##   [1]  380  840 1130  750  920  540  300  510  430  770  380  620  530  700
##  [15]  250  290  640  580  740  350  380  480  580  520  680  570  530  530
##  [29]  670  560  730  690  630  800  370  480  760 1210 1510 2430  180  270
##  [43]  440  890 1770  640  960 1600  140  270  490  190  320  490  220  350
##  [57]  520  430  310  270  120  230  350  470  500  130  190  260  390  970
##  [71]  490  440   70  110  140  210  430  450  500  450  540  350  860  720
##  [85]  710  640  340  410  380  450  600  870  640  650  740  710  720  800
##  [99] 1280 1120 1130 1220 1120  450  450  450  610  680  430  570  450  280
## [113]  470  740 1000 1350  380  560  350  610  970 1080 1190  330  440  550
## [127]  730  100  370  430  410  340  320  500  210  830  320  330  400  450
## [141]  630  650  690  690  540  650  690  550  540  360  510  640  480  710
## [155]  740  750  610  300  680  710  840  240  360  600  680  550  710  520
## [169]  800  620  740  590  600  430  650 1030  730  470  980  290  290  220
## [183]  210  240  300  240  200   70  430  420  230  720 1550 1000  330  290
## [197] 1040  730 1100  300  520  450  360  900  580 1220  260  550  990  940
## [211]  310 1250  730  970 1100  770  900  990  660  760  340  380  590  720
## [225]  550  690  530  670  560  700  320  450  220  230  830  440  530  410
## [239]  480  730  290  190  290  950  470  570  580  430  670  470  330  310
## [253]  300  630  340  410  840  210  530  410  700  760 1000  800  630  540
## [267]  570  400  630 1030 1260  420  390  380  330  290  350  310  250  550
## [281] 1050  760  260  470  400  640  540  350  780  580  910  350  500  640
## [295]  520  280  600  350  380  150  360  280   20  550  320  640  430  860
## [309]  580 1160  500 1000  180  290  580  330  660  570 1140  570 1140  460
## [323]  920  370  740  470  940  410  820  550 1100  480  960  320  640  200
## [337]  320  640  350  700  480  960  380  760  310  620  370  740  420  840
## [351]  380  760  470  940  390  780  180  280  560  280  560  490  980  150
## [365]  230  460  390  780  300  150  400  330  110  360  280  150  510  180
## [379]  220  230  230  310  140  140  310  210  140  200  200  310  110  110
## [393]   50  760  730  810  740  680  790  820  540  460  510  370  550  440
## [407]  410  420  390  390  760  780  740  420  380  610  610  630  550  620
## [421]  630  650  400  710  650  670  540  550  570  410  880  830  820  170
## [435]  320  160  200  170  200  320  350  340  350  380  320  170  200  250
## [449]  320  170  200  230  200  250  340  340  370  600  420  440  600  350
## [463]  340  340  150  140  150  170  490  490  490  490  570  300  270  270
## [477]  710  760  430  320  260  410  210  420  430  560  580  540  480  190
## [491]  520  620  290  650  540  270  580  470  540  270  440  440  460  180
## [505]  400  200  390  520  700  780  780  720</code></pre>
<pre class="r"><code># library(rpart)
# library(rpart.plot)
# m1 &lt;- rpart(
#   formula = calories ~ .,
#   data    = train,
#   method  = &quot;anova&quot;,
#   control = rpart.control(minsplit = 10, cp = 0.0001)
#   )</code></pre>
<pre class="r"><code># printcp(m1)
# plotcp(m1)
# rpart.plot(m1,cex = 0.5)
# 
# 
# #Prune down the tree
# bestcp=m1$cptable[which.min(m1$cptable[,&quot;xerror&quot;]),&quot;CP&quot;]
# bestcp
# ptree=prune(m1,cp=bestcp)
# rpart.plot(ptree,cex = 0.6)
# summary(m1)</code></pre>
<pre class="r"><code># library(broom)
# 
# (coefs &lt;- model$glmnet.fit %&gt;%
#   tidy())
# coefs %&gt;%
#   group_by(estimate &gt; 0) %&gt;%
#   top_n(10, abs(estimate)) %&gt;%
#   ungroup() %&gt;%
#   ggplot(aes(fct_reorder(term, estimate), estimate, fill = estimate &gt; 0)) +
#   geom_col(alpha = 0.8, show.legend = FALSE) +
#   coord_flip() +
#   labs(
#     x = NULL,
#     title = &quot;Coefficients that increase/decrease probability the most&quot;,
#     subtitle = &quot;A document mentioning Martians is unlikely to be written by Jane Austen&quot;
#   )</code></pre>
<p>Filter out instances where item title contains “w/o”</p>
<pre class="r"><code>food&lt;-food %&gt;% filter(!str_detect(item,&quot;w/o&quot;)) %&gt;% mutate(
    meat_type = case_when(
      str_detect(item, &quot;[Bb]acon|BLT|B.L.T&quot;) &amp; !str_detect(item, &quot;Bacon.*Chicken|Chicken.*Bacon&quot;) ~ &quot;bacon&quot;,
      str_detect(item, &quot;Bacon.*Chicken|Chicken.*Bacon&quot;) ~ &quot;bacon,chicken&quot;,
      str_detect(item, &quot;[Cc]hick&quot;) ~ &quot;chicken&quot;,
      str_detect(item, &quot;[Bb]eef|[Cc]heeseburger|[Hh]amburger&quot;) ~ &quot;beef&quot;,
      str_detect(item, &quot;[Tt]urkey&quot;) ~ &quot;turkey&quot;,
      str_detect(item, &quot;[Ss]teak&quot;) ~ &quot;steak&quot;,
      TRUE~&quot;other&quot;)) </code></pre>
<pre class="r"><code>meat_stat&lt;-food %&gt;% 
  group_by(meat_type) %&gt;%
  summarise_at(c(&quot;calories&quot;,&quot;total_carb&quot;,&quot;total_fat&quot;,&quot;protein&quot;),~mean(.,na.rm = T)) %&gt;%
  gather(stat,mean_content,-meat_type) %&gt;%
  filter(meat_type!=&quot;other&quot;)

##create order within facet plot
meat_stat&lt;-meat_stat %&gt;% 
  #group by facet var, catg. var
  group_by(stat,meat_type) %&gt;% 
  arrange(desc(mean_content)) %&gt;% 
  ungroup() %&gt;% 
  mutate(meat_type=factor(paste(meat_type,stat, sep = &quot;__&quot;), levels = rev(paste(meat_type,stat, sep = &quot;__&quot;)))) 
  

meat_stat %&gt;% 
  ggplot(aes(meat_type,mean_content,fill=stat)) + 
  geom_bar(stat = &quot;identity&quot;) +
  facet_wrap(~stat,scales=&quot;free&quot;) +
  coord_flip()+ scale_x_discrete(labels = function(x) gsub(&quot;__.+$&quot;, &quot;&quot;, x)) +scale_fill_brewer()+theme_dark()</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code>food %&gt;% filter(meat_type!=&quot;other&quot;,calories&lt;1500) %&gt;%  ggplot()+geom_jitter(aes(x=total_carb,y=calories,color=&quot;total_carb&quot;))+ geom_jitter(aes(x=protein,y=calories,color=&quot;protein&quot;))+geom_jitter(aes(x=total_fat,y=calories,color=&quot;total_fat&quot;))+facet_wrap(~meat_type)+xlab(&quot;&quot;)+coord_flip()</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code>ggplotRegression &lt;- function(dat, xvar, yvar){

  fml &lt;- paste(yvar, &quot;~&quot;, xvar)

  fit &lt;- lm(fml, dat)

  ggplot(fit$model, aes_string(x = names(fit$model)[2], y = names(fit$model)[1])) +
    geom_point() +
    stat_smooth(method = &quot;lm&quot;, col = &quot;red&quot;) +
    labs(title = paste(&quot;Adj R2 = &quot;,signif(summary(fit)$adj.r.squared, 5)))+coord_flip()
}
ggplotRegression(food,&quot;total_carb&quot;, &quot;calories&quot;)
ggplotRegression(food,&quot;protein&quot;, &quot;calories&quot;)
ggplotRegression(food,&quot;total_fat&quot;, &quot;calories&quot;)</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-23-1.png" width="33%" /><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-23-2.png" width="33%" /><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-23-3.png" width="33%" /></p>
<p>Have numeric only saved as food_num
Correlation with calories</p>
<pre class="r"><code>mycolors &lt;- colorRampPalette(brewer.pal(13, &quot;RdYlBu&quot;))(13)</code></pre>
<pre><code>## Warning in brewer.pal(13, &quot;RdYlBu&quot;): n too large, allowed maximum for palette RdYlBu is 11
## Returning the palette you asked for with that many colors</code></pre>
<pre class="r"><code>cor_df&lt;-correlate(food_num)

cor_df %&gt;% focus(calories) %&gt;% mutate(rowname=reorder(rowname,calories)) %&gt;% ggplot(aes(x=rowname,y=calories,fill=rowname))+geom_bar(stat = &quot;identity&quot;)+coord_flip()+scale_fill_manual(values=mycolors)</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<pre class="r"><code>cor_df %&gt;% focus(cal_fat) %&gt;% mutate(rowname=reorder(rowname,cal_fat)) %&gt;% ggplot(aes(x=rowname,y=cal_fat,fill=rowname))+geom_bar(stat = &quot;identity&quot;)+coord_flip()+scale_fill_manual(values=mycolors)</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Want food high protein, low fat,low protein
Which rest. has best selection of high protein, low fat (As percentage?)
Add category bins
How many menu items at McD are l</p>
<pre class="r"><code>#fat dist
food %&gt;% ggplot(aes(total_fat))+geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<pre class="r"><code>food %&gt;% select(restaurant,item,total_fat) %&gt;% top_n(10) %&gt;% arrange(desc(total_fat))</code></pre>
<pre><code>## Selecting by total_fat</code></pre>
<pre><code>## # A tibble: 12 x 3
##    restaurant  item                                             total_fat
##    &lt;fct&gt;       &lt;chr&gt;                                                &lt;dbl&gt;
##  1 Mcdonalds   20 piece Buttermilk Crispy Chicken Tenders             141
##  2 Burger King American Brewhouse King                                126
##  3 Mcdonalds   40 piece Chicken McNuggets                             107
##  4 Sonic       Garlic Parmesan Dunked Ultimate Chicken Sandwich       100
##  5 Sonic       Super Sonic Bacon Double Cheeseburger (w/mayo)          92
##  6 Mcdonalds   12 piece Buttermilk Crispy Chicken Tenders              88
##  7 Sonic       Super Sonic Double Cheeseburger W/ Mayo                 87
##  8 Burger King Rodeo King                                              82
##  9 Burger King Farmhouse King                                          80
## 10 Sonic       Super Sonic Double Cheeseburger W/ Mustard              76
## 11 Sonic       Super Sonic Double Cheeseburger W/ Ketchup              76
## 12 Sonic       Super Sonic Jalapeno Double Cheeseburger                76</code></pre>
<pre class="r"><code>summary(food$total_fat)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    0.00   14.00   23.00   26.63   35.00  141.00</code></pre>
<pre class="r"><code>food %&gt;% ggplot(aes(total_carb))+geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-27-1.png" width="672" />
Pass new variable name (e.g. “tfat_cat”) –&gt; use !!new_var:= within function</p>
<pre class="r"><code># Function to create new binned categorical variables with specified cutoffs

new_cat&lt;-function(new_var,old_var,low,medium,df){
  df %&gt;% 
  mutate(!!new_var:= case_when(
    old_var&lt;low ~&quot;low&quot;,
    old_var&lt;medium~&quot;medium &quot;,
    TRUE~&quot;high&quot;))
}

#create new binned categorical variables for total fat
food &lt;-new_cat(&quot;tfat_cat&quot;,food$total_fat,10,30,food) 
food %&gt;% group_by(tfat_cat) %&gt;% count()</code></pre>
<pre><code>## # A tibble: 3 x 2
## # Groups:   tfat_cat [3]
##   tfat_cat      n
##   &lt;chr&gt;     &lt;int&gt;
## 1 high        174
## 2 low          65
## 3 &quot;medium &quot;   268</code></pre>
<pre class="r"><code>(rest_fat&lt;-food %&gt;% group_by(restaurant,tfat_cat) %&gt;% count() %&gt;% 
##add missing low category for BK, Sonic
complete(restaurant,tfat_cat) %&gt;% unique()%&gt;% mutate(n=replace(n,is.na(n), 0)))</code></pre>
<pre><code>## # A tibble: 24 x 3
## # Groups:   restaurant, tfat_cat [24]
##    restaurant  tfat_cat     n
##    &lt;fct&gt;       &lt;chr&gt;    &lt;dbl&gt;
##  1 Arbys       high        25
##  2 Burger King high        35
##  3 Chick Fil-A high         3
##  4 Dairy Queen high        17
##  5 Mcdonalds   high        23
##  6 Sonic       high        29
##  7 Subway      high        21
##  8 Taco Bell   high        21
##  9 Arbys       low          5
## 10 Burger King low          0
## # … with 14 more rows</code></pre>
<pre class="r"><code>rest_fat %&gt;% ggplot(aes(x=restaurant,y=n,fill=fct_reorder(tfat_cat,n)))+geom_col(position=&quot;fill&quot;)</code></pre>
<p><img src="/post/2019-04-10-fast-food-nutrition-analysis_files/figure-html/unnamed-chunk-30-1.png" width="672" />
Burger King &amp; Sonic have no low fat menu items in the dataset. Chick-fil-A has the smallest percentage of high fat items, while Subway has the highest percentange of low fat items.</p>
<p>```</p>
</div>
