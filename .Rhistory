food<-read_csv("fastfood_calories.csv")
library(tidyverse)
library(ggthemes)
library(tidytext)
library(purrr)
library(stats)
library(corrr)
library(RColorBrewer)
food<-read_csv("fastfood_calories.csv")
food<-read_csv("fastfood_calories.csv")
head(food)
levels(as.factor(food$salad))
#All salad levels are "Other." This column can be removed.
food$salad<-NULL
food$X1<-NULL
#convert restaraunt to factor
food$restaurant<-as.factor(food$restaurant)
levels(food$restaurant)
library(blogdown)
serve_site()
serve_site()
blogdown:::new_post_addin()
library(rvest)
library(unpivotr)
install.packages("unpivotr")
install.packages("htmltools")
install.packages("htmltools")
library(rvest)
library(unpivotr)
library(htmltools)
library(tidyverse)
?as_cells
library(rvest)
library(unpivotr)
library(htmltools)
library(tidyverse)
#read in html data
link<-"https://www.dvcrequest.com/point-chart/bay_lake_towers_2020.html"
hlink<- read_html(link)
table<-hlink %>% html_nodes("table") %>%
html_table(header=F,fill=T)
table <- table[[1]]
#add the table to a dataframe,
dict <- as.data.frame(table)
cells <- as_cells(table)
cells<-cells %>% filter(col>2,row>1) %>% select(-data_type)
cells %>% head()
cells %>% spread(row,chr)
cells %>% head(10)
cellstemp<-
cells %>% spread(row,chr) %>% filter(!col %in% c('6','10','14'))
room_view<-cellstemp[,2:3]
#seasons
adventure<-cellstemp[,4:6]
choice<-cellstemp[,7:9]
dream<-cellstemp[,10:12]
magic<-cellstemp[,13:15]
premier<-cellstemp[,16:18]
adventure<-cbind(room_view,adventure)
choice<-cbind(room_view,choice)
dream<-cbind(room_view,dream)
magic<-cbind(room_view,magic)
premier<-cbind(room_view,premier)
dfs<-data.frame(Map(c,adventure,choice,dream,magic,premier))
dfs %>% head()
dfs<-dfs %>% rename_at(c(1,2,3,4,5),~c("room","view","season","Sun_Th","Fri_Sat")) %>%
mutate_at(vars('Sun_Th','Fri_Sat'),as.character) %>%
mutate_at(vars('Sun_Th','Fri_Sat'),as.numeric)
dfl<-dfs %>% gather("weekday", "points",Sun_Th:Fri_Sat)
dfl$room<-as.character(dfl$room)
head(dfl)
#change naming of room type
dfl[dfl$room == "STUDIO(Sleeps up to 4)","room"] = "Studio"
dfl[dfl$room == "1-BEDROOM\r\n      VACATION HOME(Sleeps up to 5)","room"] = "1-Bedroom"
dfl[dfl$room == "2-BEDROOM\r\n      VACATION HOME(Sleeps up to 9)","room"] = "2-Bedroom"
dfl[dfl$room == "3-BEDROOM\r\n  GRAND VILLA(Sleeps up to 12)","room"] = "3-Bedroom"
head(dfl)
dfl %>%
ggplot(aes(x=fct_reorder(room,points),y=points,fill=fct_reorder(view,points)))+geom_boxplot()+scale_fill_brewer(palette= "OrRd")
dfl %>%
ggplot(aes(x=fct_reorder(room,points),y=points,fill=fct_reorder(view,points)))+
geom_boxplot()+
scale_fill_brewer(palette= "OrRd")+
theme(legend.title = "View")
dfl %>%
ggplot(aes(x=fct_reorder(room,points),y=points,fill=fct_reorder(view,points)))+
geom_boxplot()+
scale_fill_brewer(palette= "OrRd")+
theme(legend.title = element_text("View"))
dfl %>%
ggplot(aes(x=fct_reorder(room,points),y=points,fill=fct_reorder(view,points)))+
geom_boxplot()+
scale_fill_brewer(palette= "OrRd")+
xlab("")
dfl %>%
ggplot(aes(x=fct_reorder(room,points),y=points,fill=fct_reorder(view,points)))+
geom_boxplot()+
scale_fill_brewer(palette= "OrRd")+
labs(x="",fill="View")
install.packages("plotly")
install.packages("plotly")
library(plotly)
library(blogdown)
serve_site()
serve_site()
library(rvest)
library(unpivotr)
library(htmltools)
library(tidyverse)
library(kableExtra)
#read in html data
link<-"https://www.dvcrequest.com/point-chart/bay_lake_towers_2020.html"
hlink<- read_html(link)
table<-hlink %>% html_nodes("table") %>%
html_table(header=F,fill=T)
table <- table[[1]]
#add the table to a dataframe,
dict <- as.data.frame(table)
cells <- as_cells(table)
cells<-cells %>% filter(col>2,row>1) %>% select(-data_type)
cells %>% head(10) %>% kable()
library(blogdown)
serve_site()
library(rvest)
library(unpivotr)
library(htmltools)
library(tidyverse)
library(kableExtra)
#read in html data
link<-"https://www.dvcrequest.com/point-chart/bay_lake_towers_2020.html"
hlink<- read_html(link)
table<-hlink %>% html_nodes("table") %>%
html_table(header=F,fill=T)
table <- table[[1]]
#add the table to a dataframe,
dict <- as.data.frame(table)
cells <- as_cells(table)
cells<-cells %>% filter(col>2,row>1) %>% select(-data_type)
cells %>% head() %>% kable()
cellstemp<-
cells %>% spread(row,chr) %>% filter(!col %in% c('6','10','14'))
room_view<-cellstemp[,2:3]
#seasons
adventure<-cellstemp[,4:6]
choice<-cellstemp[,7:9]
dream<-cellstemp[,10:12]
magic<-cellstemp[,13:15]
premier<-cellstemp[,16:18]
adventure<-cbind(room_view,adventure)
choice<-cbind(room_view,choice)
dream<-cbind(room_view,dream)
magic<-cbind(room_view,magic)
premier<-cbind(room_view,premier)
dfs<-data.frame(Map(c,adventure,choice,dream,magic,premier))
dfs %>% head() %>% kable()
?kable
blogdown:::new_post_addin()
avg_points<-comp %>%
filter(room != "3-Bedroom") %>%
group_by(season,room,resort) %>% summarise(avg_point=mean(points))
library(tidyverse)
library(lubridate)
library(plotly)
install.packages("plotly")
install.packages("plotly")
library(tidyverse)
library(lubridate)
library(plotly)
bc<-readRDS("BC2020.rds")
library(tidyverse)
library(lubridate)
library(plotly)
bc<-readRDS("BC2020.rds")
library(tidyverse)
library(lubridate)
library(plotly)
bc<-readRDS("BC2020.rds")
BC2020 <- readRDS("~/mysite/content/post/BC2020.rds")
library(tidyverse)
library(lubridate)
library(plotly)
bc<-readRDS("BC2020.rds")
install.packages(c("lubridate", "plotly", "tidyverse"))
install.packages("blogdown")
install.packages("plotly")
library(tidyverse)
library(lubridate)
library(plotly)
bc<-readRDS("BC2020.rds")
blt<-readRDS("BLT2020.rds")
comp<-bind_rows(bc,blt)
comp$resort<-as.factor(comp$resort)
head(comp)
avg_points<-comp %>%
filter(room != "3-Bedroom") %>%
group_by(season,room,resort) %>% summarise(avg_point=mean(points))
avg_points %>%
ungroup() %>%
ggplot(aes(x=fct_reorder(season,avg_point),y=avg_point, group=resort))+
geom_col(aes(fill=resort),position = "dodge")+
geom_text(aes(label=round(avg_point,1)),position = position_dodge(0.9),vjust = 0)+
scale_fill_manual(values = c("skyblue","maroon"))+
facet_wrap(~room)+
coord_flip()+
labs(y="Points",x="")
diff<-avg_points %>%
group_by(season,room) %>%
transmute(Diff = avg_point- lag(avg_point)) %>%
filter(!is.na(Diff)) %>%
ungroup()
pldiff<-
diff %>% ggplot(aes(x=season,y=Diff,group=room))+geom_line(aes(color=room))+geom_point()+labs(y="Avg Point Difference / Night   (BLT-BC)")
ggplotly(pldiff)
#remove 3-Bed and MK/LV rooms (Beach Club does not have)
sv_only<-comp %>%
filter(room != "3-Bedroom", !view %in% c("MK","LV")) %>%
group_by(season,room,resort) %>% summarise(avg_point=mean(points))
sv_only<-sv_only %>%
#get difference
group_by(season,room) %>%
transmute(Diff = avg_point- lag(avg_point)) %>%
filter(!is.na(Diff)) %>%
ungroup()
difplot2<- sv_only %>%
ggplot(aes(x=season,y=Diff,group=room))+
geom_line(aes(color=room))+
geom_point()+
labs(y="Point Difference / Night  (BLT-BC)")
ggplotly(difplot2)
#ymd() in lubridate package means "month-day-year", which is used to convert
#the string to date object
start_date <- ymd("2020-01-01")
#calculate how many days in time interval
date<-start_date + days(0:365)
date<-as.data.frame(date)
date %>% head()
library(blogdown)
serve_site()
serve_site()
serve_site()
#ymd() in lubridate package means "month-day-year", which is used to convert
#the string to date object
start_date <- ymd("2020-01-01")
#calculate how many days in time interval
date<-start_date + days(0:365)
date<-as.data.frame(date)
ad_ints<- c(interval(ymd("2020-01-01"), ymd("2020-01-31")),interval(ymd("2020-09-01"), ymd("2020-09-30")),interval(ymd("2020-12-01"), ymd("2020-12-14")))
choice_ints<- c(interval(ymd("2020-10-01"), ymd("2020-11-24")),interval(ymd("2020-11-28"), ymd("2020-11-30")),interval(ymd("2020-12-15"), ymd("2020-12-23")))
dream_ints<- c(interval(ymd("2020-02-01"), ymd("2020-02-15")),interval(ymd("2020-05-01"), ymd("2020-06-10")),interval(ymd("2020-08-16"), ymd("2020-08-31")))
magic_ints<- c(interval(ymd("2020-02-16"), ymd("2020-04-04")),interval(ymd("2020-04-19"), ymd("2020-04-30")),interval(ymd("2020-06-11"), ymd("2020-08-15")),interval(ymd("2020-11-25"), ymd("2020-11-27")))
premier_ints<- c(interval(ymd("2020-04-05"), ymd("2020-04-18")),interval(ymd("2020-12-24"), ymd("2020-12-31")))
df<-date %>% mutate(
season=case_when(
##date falls within any 3 date ranges for each season
date %within% ad_ints[1] | date %within% ad_ints[2]| date %within% ad_ints[3]~ "adventure",
date %within% dream_ints[1] | date %within% dream_ints[2]| date %within% dream_ints[3]~ "dream",
date %within% magic_ints[1] | date %within% magic_ints[2]| date %within% magic_ints[3]| date %within% magic_ints[4]~ "magic",
date %within% choice_ints[1] | date %within% choice_ints[2]| date %within% choice_ints[3]~ "choice",
date %within% premier_ints[1] | date %within% premier_ints[2]| date %within% premier_ints[3]~ "premier",
)
)
df %>% head()
comp<-comp %>% filter(!view %in% c("MK","LV")) %>% select(-view) %>% mutate(
season=map_chr(season,~str_to_lower(.x)))
all_dates<-left_join(df,comp,by="season")
all_dates %>% head()
#function to create plot
plot_comp<-function(roomtype,weekdaytype){
all_dates %>% filter(room==roomtype,weekday==weekdaytype) %>%
ggplot(aes(x=date,y=points,group=resort))+
geom_point(aes(color=season))+
scale_x_date(limits = as.Date(c("2020-01-01","2020-12-31")))+
labs(y="Points",x="")+
ggtitle(paste(roomtype,weekdaytype,sep = ","))+
theme(panel.spacing = unit(2, "lines"))+
facet_wrap(~resort)
}
plot_comp("Studio","Sun_Th")
plot_comp("1-Bedroom","Sun_Th")
plot_comp("2-Bedroom","Sun_Th")
plot_comp("Studio","Fri_Sat")
plot_comp("1-Bedroom","Fri_Sat")
plot_comp("2-Bedroom","Fri_Sat")
#15 combinations of room & season (3x5)
#some ties kept
comp %>% group_by(room,season,weekday) %>% top_n(1,points) %>% arrange(room,season,weekday)
all_dates<- all_dates %>%
mutate(weekday_name=wday(date,label = T),
is_weekend=if_else(weekday_name %in% c("Fri","Sat"),1,0)) %>%
filter(weekday=="Sun_Th"& is_weekend==0 |weekday=="Fri_Sat"& is_weekend==1 ) %>%
arrange(room,season)
all_dates %>% head()
all_dates %>% select(-weekday,-is_weekend)->all_dates
install.packages(c("kableExtra", "keras", "SnowballC", "tidytext", "zoo"))
library(tidyverse)
library(zoo)
library(knitr)
library(tidytext)
library(SnowballC)
library(keras)
library(kableExtra)
#load data
rdf<-readRDS("first_3000.Rda")
str(rdf)
#rename & change variable type
rdf <- rdf %>% rename(stay_date = id_date,
review = reviews) %>%
mutate_at(vars(stay_date, review),
~ as.character(.)) %>%
mutate(rating = as.factor(rating))
#change stay_date variable from character to date type
rdf$stay_date <- gsub("Date of stay: ", "", rdf$stay_date)
rdf$stay_date <- as.yearmon(rdf$stay_date, "%b %Y")
kable(head(rdf,3)) %>% kable_styling(bootstrap_options = "striped", full_width = F,font_size = 8)
#set color
colors<-c("cadetblue1", "deepskyblue", "deepskyblue3","deepskyblue4","dodgerblue3")
rdf %>%
ggplot(aes(x=rating,fill=rating))+geom_bar()+scale_fill_manual(values=colors)
rdf_tidy <- rdf %>% mutate(review_num = row_number()) %>%
unnest_tokens(word, review) %>%
anti_join(stop_words) %>% filter(str_detect(word, "^[a-z']+$")) %>%
distinct()
most_common_words <- rdf_tidy %>%
group_by(word) %>%
summarize(freq = n()) %>%
arrange(desc(freq))
#rearrange by frequency, eliminate duplicates
most_common_words %>%
mutate(word = reorder(word, freq)) %>%
head(25) %>%  ggplot(aes(x = word, y = freq)) + geom_segment(aes(
x = word ,
xend = word,
y = 0,
yend = freq
), color = "black") +
geom_point(size = 3, color = "deepskyblue") +
labs(title = "Top 25 Most Common Words in Review Text", y = "# times used", x =
"") + coord_flip()
#group rating 1&2 into "low" category; rating 3,4,& 5 & into "high" category
by_rate <- rdf %>%
mutate(rating_group = case_when(rating == "1" |
rating == "2" ~ "low", TRUE ~ "high"))
by_rate_inverse <- by_rate %>% unnest_tokens(word, review) %>%
count(rating_group, word, sort = TRUE) %>% filter(!nchar(word) <= 3) %>%
bind_tf_idf(word, rating_group, n) %>% group_by(rating_group) %>%
mutate(rank = rank(desc(tf_idf), ties.method = "first")) %>%
arrange(rank)
by_rate_inverse %>%
mutate(word = factor(word, levels = rev(unique(word)))) %>%
group_by(rating_group) %>% filter(rank <= 10) %>%
ungroup() %>%
ggplot(aes(word, tf_idf, fill = rating_group)) +
geom_col(show.legend = FALSE) +
labs(x = NULL, y = "tf-idf") +
facet_wrap( ~ rating_group, ncol = 2, scales = "free") +
coord_flip()
##bigram: separate-->filter out stop words; put back together-->count
bigram_filt<-rdf %>%
unnest_tokens(bigram, review, token = "ngrams", n = 2) %>%
separate(bigram, c("word1", "word2"), sep = " ") %>%
filter(!word1 %in% stop_words$word) %>%
filter(!word2 %in% stop_words$word)
bigram_count <- bigram_filt %>%
unite(bigram, word1, word2, sep = " ") %>%
count(bigram, sort = TRUE)
bigram_count %>% filter(!str_detect(bigram,"floridian")) %>% head(25) %>%  mutate(bigram = reorder(bigram, n)) %>%
ggplot(aes(x=bigram,y=n))+ geom_segment(aes(x=bigram ,xend=bigram, y=0, yend=n),color="black") +
geom_point(size=3, color="deepskyblue")+
labs(title = "Top 25 Most Common Bigrams in Review Text", y = "# times used", x="") + coord_flip()
sentiment_lexicons <- tidytext::sentiments %>%
filter(lexicon != "loughran")%>%
group_by(lexicon) %>%
mutate(words_in_lexicon = n_distinct(word)) %>%
ungroup()
tidytext::sentiments
library(blogdown)
serve_site()
library(tidyverse)
library(zoo)
library(knitr)
library(tidytext)
library(SnowballC)
library(keras)
library(kableExtra)
#load data
rdf<-readRDS("first_3000.Rda")
str(rdf)
#rename & change variable type
rdf <- rdf %>% rename(stay_date = id_date,
review = reviews) %>%
mutate_at(vars(stay_date, review),
~ as.character(.)) %>%
mutate(rating = as.factor(rating))
#change stay_date variable from character to date type
rdf$stay_date <- gsub("Date of stay: ", "", rdf$stay_date)
rdf$stay_date <- as.yearmon(rdf$stay_date, "%b %Y")
kable(head(rdf,3)) %>% kable_styling(bootstrap_options = "striped", full_width = F,font_size = 8)
#set color
colors<-c("cadetblue1", "deepskyblue", "deepskyblue3","deepskyblue4","dodgerblue3")
rdf %>%
ggplot(aes(x=rating,fill=rating))+geom_bar()+scale_fill_manual(values=colors)
rdf_tidy <- rdf %>% mutate(review_num = row_number()) %>%
unnest_tokens(word, review) %>%
anti_join(stop_words) %>% filter(str_detect(word, "^[a-z']+$")) %>%
distinct()
most_common_words <- rdf_tidy %>%
group_by(word) %>%
summarize(freq = n()) %>%
arrange(desc(freq))
#rearrange by frequency, eliminate duplicates
most_common_words %>%
mutate(word = reorder(word, freq)) %>%
head(25) %>%  ggplot(aes(x = word, y = freq)) + geom_segment(aes(
x = word ,
xend = word,
y = 0,
yend = freq
), color = "black") +
geom_point(size = 3, color = "deepskyblue") +
labs(title = "Top 25 Most Common Words in Review Text", y = "# times used", x =
"") + coord_flip()
#group rating 1&2 into "low" category; rating 3,4,& 5 & into "high" category
by_rate <- rdf %>%
mutate(rating_group = case_when(rating == "1" |
rating == "2" ~ "low", TRUE ~ "high"))
by_rate_inverse <- by_rate %>% unnest_tokens(word, review) %>%
count(rating_group, word, sort = TRUE) %>% filter(!nchar(word) <= 3) %>%
bind_tf_idf(word, rating_group, n) %>% group_by(rating_group) %>%
mutate(rank = rank(desc(tf_idf), ties.method = "first")) %>%
arrange(rank)
by_rate_inverse %>%
mutate(word = factor(word, levels = rev(unique(word)))) %>%
group_by(rating_group) %>% filter(rank <= 10) %>%
ungroup() %>%
ggplot(aes(word, tf_idf, fill = rating_group)) +
geom_col(show.legend = FALSE) +
labs(x = NULL, y = "tf-idf") +
facet_wrap( ~ rating_group, ncol = 2, scales = "free") +
coord_flip()
##bigram: separate-->filter out stop words; put back together-->count
bigram_filt<-rdf %>%
unnest_tokens(bigram, review, token = "ngrams", n = 2) %>%
separate(bigram, c("word1", "word2"), sep = " ") %>%
filter(!word1 %in% stop_words$word) %>%
filter(!word2 %in% stop_words$word)
bigram_count <- bigram_filt %>%
unite(bigram, word1, word2, sep = " ") %>%
count(bigram, sort = TRUE)
bigram_count %>% filter(!str_detect(bigram,"floridian")) %>% head(25) %>%  mutate(bigram = reorder(bigram, n)) %>%
ggplot(aes(x=bigram,y=n))+ geom_segment(aes(x=bigram ,xend=bigram, y=0, yend=n),color="black") +
geom_point(size=3, color="deepskyblue")+
labs(title = "Top 25 Most Common Bigrams in Review Text", y = "# times used", x="") + coord_flip()
get_sentiments(lexicon = c("afinn", "bing", "loughran", "nrc"))
install.packages("textdata")
get_sentiments(lexicon = c("afinn", "bing", "loughran", "nrc"))
get_sentiments(lexicon = c("afinn", "bing", "loughran", "nrc"))
get_sentiments(lexicon ="bing")
get_sentiments(lexicon ="bing") %>% mutate(lexicon="bing")
bing<-get_sentiments(lexicon ="bing") %>% mutate(lexicon="bing")
afinn<-get_sentiments(lexicon ="afinn") %>% mutate(lexicon="afinn")
rbind(bing,afinn)
bing
afinn
bing
afinn
get_sentiments(lexicon ="afinn") %>% mutate(value="sentiment",lexicon="afinn")
get_sentiments(lexicon ="afinn") %>% select(words,sentiment=value) %>% mutate(lexicon="afinn")
get_sentiments(lexicon ="afinn") %>% select(words,value=sentiment) %>% mutate(lexicon="afinn")
get_sentiments(lexicon ="afinn") %>% rename(sentiment=value) %>% mutate(lexicon="afinn")
get_sentiments(lexicon ="bing") %>% mutate(lexicon="bing")
bing<-get_sentiments(lexicon ="bing") %>% mutate(lexicon="bing")
afinn<-get_sentiments(lexicon ="afinn") %>% rename(sentiment=value) %>% mutate(lexicon="afinn")
sentiments_df<-rbind(bing,afinn)
sentiments_df
sentiments_df <- sentiments_df %>%
group_by(lexicon) %>%
mutate(words_in_lexicon = n_distinct(word)) %>%
ungroup()
sentiment_lexicons %>%
group_by(lexicon) %>%
summarise(distinct_words = n_distinct(word)) %>%
ungroup()
sentiments_df %>%
group_by(lexicon) %>%
summarise(distinct_words = n_distinct(word)) %>%
ungroup()
rdf_tidy %>%
mutate(words_in_reviews = n_distinct(word)) %>%
inner_join(sentiments_df) %>%
group_by(lexicon, words_in_reviews, words_in_lexicon) %>%
summarise(num_match = n_distinct(word)) %>%
ungroup() %>%
mutate(match_ratio = num_match / words_in_reviews) %>%
select(lexicon, words_in_reviews, num_match, match_ratio)
get_sentiments("afinn") %>%
select(word, afinn_score = score)
get_sentiments("afinn")
get_sentiments("afinn") %>%
select(word, afinn_score = value)
##gives word and score
afinn <- get_sentiments("afinn") %>%
select(word, afinn_score = value)
reviews_sentiment <- rdf_tidy %>%
inner_join(afinn, by = "word") %>%
group_by(review_num, rating) %>%
summarize(sentiment = mean(afinn_score))
ggplot(reviews_sentiment, aes(rating, sentiment, group = rating)) +
geom_boxplot(colour = "black",
fill = "#56B4E9",
notch = T) +
ylab("Average sentiment score")
serve_site()
